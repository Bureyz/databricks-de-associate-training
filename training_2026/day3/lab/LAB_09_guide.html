<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title> </title>
  <style>
    /* Default styles provided by pandoc.
    ** See https://pandoc.org/MANUAL.html#variables-for-html for config info.
    */
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      border: none;
      border-top: 1px solid #1a1a1a;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {  background-color: #f8f8f8; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ef2929; } /* Alert */
    code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #204a87; } /* Attribute */
    code span.bn { color: #0000cf; } /* BaseN */
    code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4e9a06; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #8f5902; font-style: italic; } /* Comment */
    code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
    code span.dt { color: #204a87; } /* DataType */
    code span.dv { color: #0000cf; } /* DecVal */
    code span.er { color: #a40000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #0000cf; } /* Float */
    code span.fu { color: #204a87; font-weight: bold; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
    code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
    code span.ot { color: #8f5902; } /* Other */
    code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
    code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
    code span.ss { color: #4e9a06; } /* SpecialString */
    code span.st { color: #4e9a06; } /* String */
    code span.va { color: #000000; } /* Variable */
    code span.vs { color: #4e9a06; } /* VerbatimString */
    code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
  </style>

<style>
  body { font-family: 'Segoe UI', Arial, sans-serif; max-width: 900px; margin: 40px auto; padding: 0 20px; color: #333; line-height: 1.6; }
  h1 { color: #1a73e8; border-bottom: 2px solid #1a73e8; padding-bottom: 8px; }
  h2 { color: #2d2d2d; border-bottom: 1px solid #ddd; padding-bottom: 6px; margin-top: 30px; }
  h3 { color: #444; margin-top: 20px; }
  code { background: #f5f5f5; padding: 2px 6px; border-radius: 3px; font-size: 0.9em; }
  pre { background: #f5f5f5; padding: 16px; border-radius: 6px; overflow-x: auto; border: 1px solid #e0e0e0; }
  pre code { background: none; padding: 0; }
  table { border-collapse: collapse; width: 100%; margin: 16px 0; }
  th, td { border: 1px solid #ddd; padding: 10px 14px; text-align: left; }
  th { background: #f0f4ff; font-weight: 600; }
  tr:nth-child(even) { background: #fafafa; }
  blockquote { border-left: 4px solid #1a73e8; margin: 16px 0; padding: 10px 20px; background: #f0f4ff; }
  .header { text-align: center; margin-bottom: 30px; padding: 20px; background: #f0f4ff; border-radius: 8px; }
  .header h1 { border: none; margin: 0; }
  .footer { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; color: #888; font-size: 0.85em; }
  @media print { body { margin: 20px; } .header { page-break-after: avoid; } }
</style>

</head>
<body>
<header id="title-block-header">
<h1 class="title"> </h1>
</header>
<h1 id="lab-09-governance-security">LAB 09: Governance &amp;
Security</h1>
<p><strong>Duration:</strong> ~40 min<br />
<strong>Day:</strong> 3<br />
<strong>After module:</strong> M09: Governance &amp; Security<br />
<strong>Difficulty:</strong> Advanced</p>
<hr />
<h2 id="scenario">Scenario</h2>
<blockquote>
<p><em>“Before the RetailHub platform goes live, the security team
requires data governance controls. The HR department must not see order
amounts. Customer PII (email, phone) must be masked for analysts.
Aggregated Gold-layer data will be shared with an external partner via
Delta Sharing.”</em></p>
</blockquote>
<hr />
<h2 id="objectives">Objectives</h2>
<p>After completing this lab you will be able to: - Grant and revoke
privileges using Unity Catalog - Create and apply Column Masks (dynamic
data masking) - Create and apply Row Filters (row-level security) -
Query <code>INFORMATION_SCHEMA</code> for metadata inspection -
Understand Delta Sharing concepts</p>
<hr />
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Completed LAB 07 (Lakeflow Pipeline) – tables in <code>gold</code>
schema available</li>
<li>Unity Catalog configured (from <code>00_setup.ipynb</code>)</li>
</ul>
<hr />
<h2 id="part-1-access-management-10-min">Part 1: Access Management (~10
min)</h2>
<h3 id="task-1-grant-privileges">Task 1: Grant Privileges</h3>
<p>Grant <code>SELECT</code> on the <code>silver</code> schema to the
<code>analysts</code> group:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">USE</span> CATALOG <span class="kw">ON</span> CATALOG ${CATALOG} <span class="kw">TO</span> `analysts`;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">USE</span> <span class="kw">SCHEMA</span> <span class="kw">ON</span> <span class="kw">SCHEMA</span> ${CATALOG}.${SILVER_SCHEMA} <span class="kw">TO</span> `analysts`;</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">SELECT</span> <span class="kw">ON</span> <span class="kw">SCHEMA</span> ${CATALOG}.${SILVER_SCHEMA} <span class="kw">TO</span> `analysts`;</span></code></pre></div>
<h3 id="task-2-verify-privileges">Task 2: Verify Privileges</h3>
<p>Query <code>INFORMATION_SCHEMA.TABLE_PRIVILEGES</code> to confirm the
grants:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> ${CATALOG}.INFORMATION_SCHEMA.TABLE_PRIVILEGES</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> grantee <span class="op">=</span> <span class="st">&#39;analysts&#39;</span>;</span></code></pre></div>
<blockquote>
<p><strong>Exam Tip:</strong> <code>GRANT SELECT ON SCHEMA</code> grants
SELECT on all current and future tables in that schema.</p>
</blockquote>
<hr />
<h2 id="part-2-column-masks-10-min">Part 2: Column Masks (~10 min)</h2>
<h3 id="task-3-create-a-masking-function">Task 3: Create a Masking
Function</h3>
<p>Create a SQL function that masks email addresses for non-admin
users:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">FUNCTION</span> ${CATALOG}.${SILVER_SCHEMA}.mask_email(email STRING)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>RETURNS STRING</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">RETURN</span> <span class="cf">CASE</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">WHEN</span> is_account_group_member(<span class="st">&#39;admins&#39;</span>) <span class="cf">THEN</span> email</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">ELSE</span> <span class="fu">CONCAT</span>(<span class="kw">LEFT</span>(email, <span class="dv">2</span>), <span class="st">&#39;***@***.***&#39;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span>;</span></code></pre></div>
<h3 id="task-4-apply-column-mask">Task 4: Apply Column Mask</h3>
<div class="sourceCode" id="cb4"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> ${CATALOG}.${SILVER_SCHEMA}.customers</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">COLUMN</span> email <span class="kw">SET</span> MASK ${CATALOG}.${SILVER_SCHEMA}.mask_email;</span></code></pre></div>
<h3 id="task-5-verify-masking">Task 5: Verify Masking</h3>
<p>Query the table as a non-admin user and verify the email column is
masked.</p>
<blockquote>
<p><strong>Exam Tip:</strong> Column Masks use
<code>is_account_group_member()</code> to determine the querying user’s
group.</p>
</blockquote>
<hr />
<h2 id="part-3-row-filters-10-min">Part 3: Row Filters (~10 min)</h2>
<h3 id="task-6-create-a-row-filter-function">Task 6: Create a Row Filter
Function</h3>
<p>Create a function that filters orders by region based on group
membership:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">FUNCTION</span> ${CATALOG}.${SILVER_SCHEMA}.region_filter(region STRING)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>RETURNS <span class="dt">BOOLEAN</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">RETURN</span> (</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    is_account_group_member(<span class="st">&#39;admins&#39;</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">OR</span> (is_account_group_member(<span class="st">&#39;east_team&#39;</span>) <span class="kw">AND</span> region <span class="op">=</span> <span class="st">&#39;East&#39;</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">OR</span> (is_account_group_member(<span class="st">&#39;west_team&#39;</span>) <span class="kw">AND</span> region <span class="op">=</span> <span class="st">&#39;West&#39;</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>);</span></code></pre></div>
<h3 id="task-7-apply-row-filter">Task 7: Apply Row Filter</h3>
<div class="sourceCode" id="cb6"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> ${CATALOG}.${SILVER_SCHEMA}.orders</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> <span class="kw">ROW</span> <span class="kw">FILTER</span> ${CATALOG}.${SILVER_SCHEMA}.region_filter <span class="kw">ON</span> (region);</span></code></pre></div>
<h3 id="task-8-verify-row-filter">Task 8: Verify Row Filter</h3>
<p>Query orders table and confirm only permitted rows are visible.</p>
<blockquote>
<p><strong>Exam Tip:</strong> Row Filters are SQL UDFs applied with
<code>ALTER TABLE ... SET ROW FILTER</code>. Remove with
<code>ALTER TABLE ... DROP ROW FILTER</code>.</p>
</blockquote>
<hr />
<h2 id="part-4-metadata-lineage-10-min">Part 4: Metadata &amp; Lineage
(~10 min)</h2>
<h3 id="task-9-query-information_schema">Task 9: Query
INFORMATION_SCHEMA</h3>
<div class="sourceCode" id="cb7"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- List all tables</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> table_schema, table_name, table_type</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> ${CATALOG}.INFORMATION_SCHEMA.<span class="kw">TABLES</span>;</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- List columns with data types</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> table_name, column_name, data_type</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> ${CATALOG}.INFORMATION_SCHEMA.<span class="kw">COLUMNS</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> table_schema <span class="op">=</span> <span class="st">&#39;${SILVER_SCHEMA}&#39;</span>;</span></code></pre></div>
<h3 id="task-10-explore-lineage">Task 10: Explore Lineage</h3>
<p>Navigate to Unity Catalog UI &gt; select a Gold table &gt; click
“Lineage” tab to view the data flow from Bronze through Silver to
Gold.</p>
<blockquote>
<p><strong>Exam Tip:</strong> Lineage is tracked automatically by Unity
Catalog – no instrumentation needed. It shows table-level and
column-level dependencies.</p>
</blockquote>
<hr />
<h2 id="summary">Summary</h2>
<p>In this lab you: - Granted and revoked privileges using
<code>GRANT</code> / <code>REVOKE</code> SQL - Created masking functions
with <code>is_account_group_member()</code> - Applied Column Masks via
<code>ALTER TABLE ... ALTER COLUMN ... SET MASK</code> - Applied Row
Filters via <code>ALTER TABLE ... SET ROW FILTER</code> - Queried
<code>INFORMATION_SCHEMA</code> for metadata inspection - Explored data
lineage in the Unity Catalog UI</p>
<table>
<colgroup>
<col style="width: 34%" />
<col style="width: 30%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th>Feature</th>
<th>Syntax</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>Column Mask</td>
<td><code>ALTER TABLE t ALTER COLUMN c SET MASK fn</code></td>
<td>Dynamic data masking</td>
</tr>
<tr>
<td>Row Filter</td>
<td><code>ALTER TABLE t SET ROW FILTER fn ON (col)</code></td>
<td>Row-level security</td>
</tr>
<tr>
<td>Remove Mask</td>
<td><code>ALTER TABLE t ALTER COLUMN c DROP MASK</code></td>
<td>Remove masking</td>
</tr>
<tr>
<td>Remove Filter</td>
<td><code>ALTER TABLE t DROP ROW FILTER</code></td>
<td>Remove RLS</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Key Functions:</strong>
<code>is_account_group_member('group')</code>,
<code>current_user()</code>, <code>SHA2(col, 256)</code></p>
</blockquote>
</body>
</html>
